{"ast":null,"code":"var _jsxFileName = \"F:\\\\swathi\\\\RESUME_PROJECTS\\\\GraphQL-Node-React-eventapp\\\\frontend\\\\src\\\\pages\\\\Bookings.js\";\nimport React, { Component } from 'react';\nimport Spinner from '../components/Spinner/Spinner';\nimport AuthContext from '../context/auth-context';\nimport BookingList from '../components/Bookings/BookingList/BookingList';\nimport BookingsChart from '../components/Bookings/BookingsChart/BookingsChart';\nimport BookingsControls from '../components/Bookings/BookingsControls/BookingsControls';\n\nclass BookingsPage extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      isLoading: false,\n      bookings: [],\n      outputType: 'list'\n    };\n\n    this.fetchBookings = () => {\n      this.setState({\n        isLoading: true\n      });\n      const requestBody = {\n        query: `\n          query {\n            bookings {\n              _id\n             createdAt\n             event {\n               _id\n               title\n               date\n               price\n             }\n            }\n          }\n        `\n      };\n      fetch('http://localhost:8000/graphql', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer ' + this.context.token\n        }\n      }).then(res => {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Failed!');\n        }\n\n        return res.json();\n      }).then(resData => {\n        const bookings = resData.data.bookings;\n        this.setState({\n          bookings: bookings,\n          isLoading: false\n        });\n      }).catch(err => {\n        console.log(err);\n        this.setState({\n          isLoading: false\n        });\n      });\n    };\n\n    this.deleteBookingHandler = bookingId => {\n      this.setState({\n        isLoading: true\n      });\n      const requestBody = {\n        query: `\n          mutation {\n            cancelBooking(bookingId: \"${bookingId}\") {\n            _id\n             title\n            }\n          }\n        `\n      };\n      fetch('http://localhost:8000/graphql', {\n        method: 'POST',\n        body: JSON.stringify(requestBody),\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: 'Bearer ' + this.context.token\n        }\n      }).then(res => {\n        if (res.status !== 200 && res.status !== 201) {\n          throw new Error('Failed!');\n        }\n\n        return res.json();\n      }).then(resData => {\n        this.setState(prevState => {\n          const updatedBookings = prevState.bookings.filter(booking => {\n            return booking._id !== bookingId;\n          });\n          return {\n            bookings: updatedBookings,\n            isLoading: false\n          };\n        });\n      }).catch(err => {\n        console.log(err);\n        this.setState({\n          isLoading: false\n        });\n      });\n    };\n\n    this.changeOutputTypeHandler = outputType => {\n      if (outputType === 'list') {\n        this.setState({\n          outputType: 'list'\n        });\n      } else {\n        this.setState({\n          outputType: 'chart'\n        });\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.fetchBookings();\n  }\n\n  render() {\n    let content = /*#__PURE__*/React.createElement(Spinner, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 115,\n        columnNumber: 23\n      }\n    });\n\n    if (!this.state.isLoading) {\n      content = /*#__PURE__*/React.createElement(React.Fragment, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(BookingsControls, {\n        activeOutputType: this.state.outputType,\n        onChange: this.changeOutputTypeHandler,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 119,\n          columnNumber: 21\n        }\n      }), /*#__PURE__*/React.createElement(\"div\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 123,\n          columnNumber: 21\n        }\n      }, this.state.outputType === 'list' ? /*#__PURE__*/React.createElement(BookingList, {\n        bookings: this.state.bookings,\n        onDelete: this.deleteBookingHandler,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 29\n        }\n      }) : /*#__PURE__*/React.createElement(BookingsChart, {\n        bookings: this.state.bookings,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 130,\n          columnNumber: 33\n        }\n      })));\n    }\n\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 16\n      }\n    }, content);\n  }\n\n}\n\nBookingsPage.contextType = AuthContext;\nexport default BookingsPage;","map":{"version":3,"sources":["F:/swathi/RESUME_PROJECTS/GraphQL-Node-React-eventapp/frontend/src/pages/Bookings.js"],"names":["React","Component","Spinner","AuthContext","BookingList","BookingsChart","BookingsControls","BookingsPage","state","isLoading","bookings","outputType","fetchBookings","setState","requestBody","query","fetch","method","body","JSON","stringify","headers","Authorization","context","token","then","res","status","Error","json","resData","data","catch","err","console","log","deleteBookingHandler","bookingId","prevState","updatedBookings","filter","booking","_id","changeOutputTypeHandler","componentDidMount","render","content","contextType"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\r\n\r\nimport Spinner from '../components/Spinner/Spinner';\r\nimport AuthContext from '../context/auth-context';\r\nimport BookingList from '../components/Bookings/BookingList/BookingList';\r\nimport BookingsChart from '../components/Bookings/BookingsChart/BookingsChart';\r\nimport BookingsControls from '../components/Bookings/BookingsControls/BookingsControls';\r\n\r\nclass BookingsPage extends Component {\r\n    state = {\r\n        isLoading: false,\r\n        bookings: [],\r\n        outputType: 'list'\r\n    };\r\n\r\n    static contextType = AuthContext;\r\n\r\n    componentDidMount() {\r\n        this.fetchBookings();\r\n    }\r\n\r\n    fetchBookings = () => {\r\n        this.setState({ isLoading: true });\r\n        const requestBody = {\r\n            query: `\r\n          query {\r\n            bookings {\r\n              _id\r\n             createdAt\r\n             event {\r\n               _id\r\n               title\r\n               date\r\n               price\r\n             }\r\n            }\r\n          }\r\n        `\r\n        };\r\n\r\n        fetch('http://localhost:8000/graphql', {\r\n            method: 'POST',\r\n            body: JSON.stringify(requestBody),\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                Authorization: 'Bearer ' + this.context.token\r\n            }\r\n        })\r\n            .then(res => {\r\n                if (res.status !== 200 && res.status !== 201) {\r\n                    throw new Error('Failed!');\r\n                }\r\n                return res.json();\r\n            })\r\n            .then(resData => {\r\n                const bookings = resData.data.bookings;\r\n                this.setState({ bookings: bookings, isLoading: false });\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n                this.setState({ isLoading: false });\r\n            });\r\n    };\r\n\r\n    deleteBookingHandler = bookingId => {\r\n        this.setState({ isLoading: true });\r\n        const requestBody = {\r\n            query: `\r\n          mutation {\r\n            cancelBooking(bookingId: \"${bookingId}\") {\r\n            _id\r\n             title\r\n            }\r\n          }\r\n        `\r\n        };\r\n\r\n        fetch('http://localhost:8000/graphql', {\r\n            method: 'POST',\r\n            body: JSON.stringify(requestBody),\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                Authorization: 'Bearer ' + this.context.token\r\n            }\r\n        })\r\n            .then(res => {\r\n                if (res.status !== 200 && res.status !== 201) {\r\n                    throw new Error('Failed!');\r\n                }\r\n                return res.json();\r\n            })\r\n            .then(resData => {\r\n                this.setState(prevState => {\r\n                    const updatedBookings = prevState.bookings.filter(booking => {\r\n                        return booking._id !== bookingId;\r\n                    });\r\n                    return { bookings: updatedBookings, isLoading: false };\r\n                });\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n                this.setState({ isLoading: false });\r\n            });\r\n    };\r\n\r\n    changeOutputTypeHandler = outputType => {\r\n        if (outputType === 'list') {\r\n            this.setState({ outputType: 'list' });\r\n        } else {\r\n            this.setState({ outputType: 'chart' });\r\n        }\r\n    };\r\n\r\n    render() {\r\n        let content = <Spinner />;\r\n        if (!this.state.isLoading) {\r\n            content = (\r\n                <React.Fragment>\r\n                    <BookingsControls\r\n                        activeOutputType={this.state.outputType}\r\n                        onChange={this.changeOutputTypeHandler}\r\n                    />\r\n                    <div>\r\n                        {this.state.outputType === 'list' ? (\r\n                            <BookingList\r\n                                bookings={this.state.bookings}\r\n                                onDelete={this.deleteBookingHandler}\r\n                            />\r\n                        ) : (\r\n                                <BookingsChart bookings={this.state.bookings} />\r\n                            )}\r\n                    </div>\r\n                </React.Fragment>\r\n            );\r\n        }\r\n        return <React.Fragment>{content}</React.Fragment>;\r\n    }\r\n}\r\n\r\nexport default BookingsPage;"]},"metadata":{},"sourceType":"module"}